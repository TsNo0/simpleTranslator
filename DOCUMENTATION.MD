# Техническая документация: Simple Translator

**Автор:** Волков Никита M3106

---

## 1. Описание проекта
Simple Translator — это расширение для VS Code, позволяющее быстро переводить выделенный текст через Google Translate без необходимости вручную копировать его в браузер.

### Основные возможности:
* **Автоматическое определение языка:** Если текст содержит кириллицу, перевод осуществляется на английский язык, иначе — на русский.
* **Интеграция с системным браузером:** Перевод открывается в новой вкладке.
* **Горячие клавиши:** Быстрый запуск через `Ctrl+T`.

---

## 2. Инструкция по использованию

1.  Откройте любой текстовый файл в VS Code.
2.  Выделите фрагмент текста, который хотите перевести.
3.  Нажмите комбинацию клавиш `Ctrl+T` (или `Cmd+T` на macOS).
    * *Альтернатива:* Откройте палитру команд (`Ctrl+Shift+P`) и введите `Translate Selection`.
4.  Расширение автоматически сформирует ссылку и откроет перевод в вашем браузере.

---

## 3. Архитектура и Техническая часть

### 3.1. Архитектура
Плагин построен на базе **Extension Host process**. Это обеспечивает стабильность работы IDE, так как расширение выполняется в отдельном процессе Node.js, изолированном от основного процесса рендеринга (UI). Взаимодействие с UI редактора происходит через асинхронный API.

### 3.2. Структура проекта
Проект является нативным расширением VS Code, написанным на TypeScript.

* `package.json` — Манифест расширения.
    * Определяет ID команды: `simple-translator.translate`.
    * Задает условия активации (`onCommand`), реализуя «ленивую загрузку».
    * Содержит настройки привязки клавиш.
* `src/extension.ts` — Основная логика приложения.
* `.vscode/launch.json` — Конфигурация для запуска отладки.

---

## 4. Документация по коду

Данный раздел содержит подробное описание функции активации и алгоритма обработки текста.

**Файл:** `src/extension.ts`
```
import * as vscode from 'vscode';

/**
 * Функция активации расширения.
 * * Является точкой входа (Entry Point). Выполняется автоматически средой VS Code 
 * при наступлении события активации, указанного в `package.json` (`onCommand`).
 * * **Логика работы:**
 * 1. Получение выделенного текста.
 * 2. Очистка текста от лишних символов (нормализация).
 * 3. Определение языка (RU <-> EN).
 * 4. Формирование ссылки и открытие браузера.
 * * @param context - Контекст расширения, предоставляемый VS Code для управления подписками.
 * * @example
 * // Вызывается процессом Extension Host автоматически:
 * activate(context);
 */
export function activate(context: vscode.ExtensionContext) {

    // Регистрация команды. Идентификатор 'simple-translator.translate' должен совпадать с package.json
    let disposable = vscode.commands.registerCommand('simple-translator.translate', () => {

        // 1. Получаем доступ к активному текстовому редактору
        const editor = vscode.window.activeTextEditor;
        if (!editor) {
            return; // Если редактор не открыт, прекращаем выполнение
        }

        // 2. Получаем объект выделения (Selection) и текст внутри него
        const selection = editor.selection;
        const text = editor.document.getText(selection);

        // Если текст отсутствует (пустое выделение), уведомляем пользователя
        if (!text) {
            vscode.window.showInformationMessage('Выделите текст для перевода!');
            return;
        }

        // 3. Санитизация (очистка) текста
        // Регулярное выражение /\s+/g заменяет переносы строк и табуляцию на один пробел
        const cleanText = text.replace(/\s+/g, ' ').trim();

        // 4. Эвристический алгоритм определения языка
        // Если в строке найдена хотя бы одна буква кириллицы -> переводим на Английский (en).
        // Иначе считаем, что текст иностранный -> переводим на Русский (ru).
        const hasCyrillic = /[а-яА-ЯёЁ]/.test(cleanText);
        const sl = hasCyrillic ? 'ru' : 'auto'; // Source Language (исходный)
        const tl = hasCyrillic ? 'en' : 'ru';   // Target Language (целевой)

        // 5. Кодирование текста для безопасной вставки в URL (обрабатывает пробелы, &, ? и др.)
        const encodedText = encodeURIComponent(cleanText);

        // 6. Формирование ссылки для Google Translate
        const url = `https://translate.google.ru/?sl=${sl}&tl=${tl}&text=${encodedText}&op=translate`;

        // 7. Открытие системного браузера с сформированной ссылкой
        vscode.env.openExternal(vscode.Uri.parse(url));
    });

    // Добавляем команду в список подписок для автоматического удаления при деактивации
    context.subscriptions.push(disposable);
}

/**
 * Функция деактивации расширения.
 * * Вызывается платформой VS Code перед отключением расширения (например, при закрытии VS Code).
 * Используется для освобождения ресурсов.
 * * @example
 * // Вызывается системой автоматически при завершении работы:
 * deactivate();
 */
export function deactivate() {}
